<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ポケモン色違い厳選カウンター</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  text-align:center;
  background:#f5f7fa;
  margin:0;
  padding:20px;
}

.card{
  background:#fff;
  padding:15px;
  margin:auto;
  max-width:520px;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

button{
  font-size:18px;
  padding:10px 14px;
  margin:4px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.primary{background:#4CAF50;color:#fff;}
.danger{background:#f44336;color:#fff;}
.gold{background:gold;}
.small{font-size:14px;padding:6px 10px;}

.item{
  padding:10px;
  margin-bottom:8px;
  background:#fafafa;
  border-radius:8px;
  border:1px solid #ddd;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.nameArea{
  text-align:left;
  flex:1;
}

.moveBtn{
  font-size:20px;
  padding:6px 10px;
  background:#eee;
}
</style>
</head>

<body>

<h1>ポケモン色違い厳選カウンター</h1>
<div id="app"></div>

<script>
let saved = JSON.parse(localStorage.getItem("shinyData") || "{}");

let data  = saved.data  || {};
let order = saved.order || Object.keys(data);
let sortMode = "manual";

function save(){
  localStorage.setItem("shinyData",
    JSON.stringify({data,order})
  );
}

/* ===== 一覧 ===== */

function renderList(){

  let html = `
  <div class="card">
    <h2>ポケモン一覧</h2>

    並び替え：
    <select onchange="changeSort(this.value)">
      <option value="manual">自由並び替え</option>
      <option value="name">名前順</option>
      <option value="countDesc">回数が多い順</option>
      <option value="countAsc">回数が少ない順</option>
    </select>
    <br><br>
  `;

  let list=[...order].filter(n=>data[n]);

  if(sortMode==="name")
    list.sort((a,b)=>a.localeCompare(b,'ja'));

  if(sortMode==="countDesc")
    list.sort((a,b)=>data[b].count-data[a].count);

  if(sortMode==="countAsc")
    list.sort((a,b)=>data[a].count-data[b].count);

  list.forEach((name,i)=>{
    html+=`
    <div class="item">

      <button class="moveBtn"
              onclick="toggleMove('${name}')">≡</button>

      <div class="nameArea">
        <b>${name}</b>（${data[name].count}回）<br>
        <button class="small primary"
                onclick="openCounter('${name}')">開く</button>
        <button class="small danger"
                onclick="deletePokemon('${name}')">削除</button>
      </div>

      <div id="move-${name}" style="display:none">
        <button class="small" onclick="moveUp('${name}')">▲</button>
        <button class="small" onclick="moveDown('${name}')">▼</button>
      </div>

    </div>`;
  });

  html+=`
    <button class="primary" onclick="addPokemon()">＋ 新しいポケモン</button>
  </div>`;

  document.getElementById("app").innerHTML=html;
}

/* ===== 並び替えモード ===== */

function changeSort(m){
  sortMode=m;
  renderList();
}

/* ===== 移動UI ===== */

function toggleMove(name){
  const el=document.getElementById("move-"+name);
  el.style.display = el.style.display==="none" ? "block":"none";
}

function moveUp(name){
  let i=order.indexOf(name);
  if(i>0){
    [order[i-1],order[i]]=[order[i],order[i-1]];
    save();
    renderList();
  }
}

function moveDown(name){
  let i=order.indexOf(name);
  if(i<order.length-1){
    [order[i+1],order[i]]=[order[i],order[i+1]];
    save();
    renderList();
  }
}

/* ===== 追加・削除 ===== */

function addPokemon(){
  const name=prompt("ポケモン名を入力");
  if(!name) return;

  if(data[name]){
    alert("既に登録されています");
    return;
  }

  data[name]={count:0};
  order.push(name);

  save();
  renderList();
}

function deletePokemon(name){
  if(!confirm(name+" を削除しますか？")) return;

  delete data[name];
  order=order.filter(n=>n!==name);

  save();
  renderList();
}

/* ===== カウンター ===== */

function openCounter(name){
  document.getElementById("app").innerHTML=`
  <div class="card">
    <h2>${name}</h2>
    <h1 id="count">${data[name].count}</h1>

    <button class="primary" onclick="inc('${name}')">+1</button>
    <button onclick="dec('${name}')">-1</button>
    <button onclick="reset('${name}')">リセット</button>

    <br><br>
    <button class="gold" onclick="shiny('${name}')">
      ✨ 色違い出現！
    </button>
    <br><br>
    <button onclick="renderList()">← 一覧へ戻る</button>
  </div>`;
}

function update(n){
  document.getElementById("count").innerText=data[n].count;
  save();
}

function inc(n){data[n].count++;update(n);}
function dec(n){data[n].count=Math.max(0,data[n].count-1);update(n);}
function reset(n){data[n].count=0;update(n);}

function shiny(name){
  alert(name+" の色違いが "+data[name].count+" 回目で出現！");
  data[name].count=0;
  update(name);
}

renderList();
</script>

</body>
</html>
